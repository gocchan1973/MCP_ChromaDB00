# 学習エラーログ機能 仕様書

## 1. 目的
ChromaDB等への学習処理において発生する全てのエラー・例外を確実に記録・可視化し、
運用者が即時に状況把握・原因特定・再発防止策を講じられるようにする。

## 2. 機能要件

### 2.1 ログ出力
- すべての学習系関数（HTML/PDF/テキスト/会話等）で、例外発生時にエラーログを出力する
- ログは`logs/learning/learning_error.log`（jsonl形式）に追記
- ログ内容には以下を含める
  - タイムスタンプ
  - エラー内容（例外メッセージ）
  - ファイル名・パス
  - コレクション名
  - 呼び出し元関数名
  - 入力パラメータ（可能な範囲で）
  - チャンク数や進捗状況（あれば）
  - ユーザーIDやセッションID（将来拡張）

### 2.2 通知
- エラー発生時、Copilotチャット上に即時通知（エラー要約＋ファイル名等）

### 2.3 ログ管理
- ログディレクトリ`logs/learning/`がなければ自動生成
- ログファイル肥大化時のローテーション（将来拡張）

## 3. 非機能要件
- ログ出力は学習処理のパフォーマンスを阻害しない
- ログは人間・機械どちらでも解析しやすい形式（jsonl）
- セキュリティ・プライバシーに配慮し、個人情報は記録しない

## 4. 工程計画

### Phase 1: 設計・基盤実装（1日）
- 仕様書作成（本ドキュメント）
- `logs/learning/`ディレクトリ構成決定
- `learning_logger.py`モジュール新規作成
  - `log_learning_error(error_dict)`関数実装
- サンプルエラーログ出力テスト

### Phase 2: 既存学習系関数への組み込み（1日）
- `learning_tools.py`等の全学習関数のexcept節で`log_learning_error()`呼び出し追加
- Copilotチャット通知（printまたはreturn値で明示）追加

### Phase 3: テスト・運用（1日）
- 意図的にエラーを発生させ、ログ・通知動作を検証
- ログ内容・通知内容の改善
- ドキュメント整備

### Phase 4: 拡張・運用最適化（将来）
- ログローテーション、通知先追加（Slack等）、学習成功ログの記録、ダッシュボード連携

## 5. 成功指標
- すべての学習エラーが漏れなく`learning_error.log`に記録される
- エラー発生時、運用者が即座にCopilotチャットで内容を把握できる
- ログから原因特定・再現が容易
